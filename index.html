<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MVP - Simulador Indicadores de Metas Mobilizadoras</title>
<link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{--azul:#2a4fda;--atl:#0b2574;--ink:#0f172a;--muted:#64748b;--grid:#e5e7eb;--bg:#f6f8fb;--ok:#047857;--warn:#b45309;--bad:#b91c1c}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:'Figtree', system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif;font-size:17px;background:var(--bg);color:var(--ink);line-height:1.45}
  h1{margin:0;font-size:30px;color:#0b2574;letter-spacing:.2px;text-align:center}
  h2{margin:0 0 6px;font-size:22px;color:#0f172a}
  .wrap{max-width:1100px;margin:22px auto;padding:0 18px}
  .card{background:#fff;border:1px solid var(--grid);border-radius:16px;box-shadow:0 10px 24px rgba(16,24,40,.06);padding:20px;margin-bottom:18px;position:relative}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .btn{background:var(--azul);color:#fff;border:none;border-radius:12px;padding:10px 16px;font-weight:700;cursor:pointer;font-family:'Figtree',sans-serif;font-size:16px}
  .btn.sec{background:#eef2ff;color:#0b2574;border:1px solid #dbeafe}
  select,input[type=number],input[type=text],textarea{padding:10px;border:1px solid #cbd5e1;border-radius:12px;background:#fff;font-size:16px;font-family:'Figtree',sans-serif}
  label{display:block;font-size:13px;color:#334155;margin:10px 0 6px}
  .suf{position:relative}
  .suf:after{content:'%';position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#64748b;font-size:12px}
  input[readonly]{background:#f8fafc;border-color:#e2e8f0;color:#64748b}
  .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:12px}
  .kpi{border:1px solid var(--grid);border-radius:14px;padding:16px;background:#fff}
  .kpi .title{font-size:13px;color:#334155}
  .kpi .value{font-size:26px;font-weight:800;color:var(--azul);line-height:1.1}
  .muted{color:#64748b;font-size:13px}
  .sub{color:#64748b;font-size:12px;margin-top:4px}
  .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px}
  .ok{background:#ecfdf5;color:#047857;border:1px solid #a7f3d0}
  .warn{background:#fff7ed;color:#b45309;border:1px solid #fed7aa}
  .bad{background:#fef2f2;color:#b91c1c;border:1px solid #fecaca}
  .note{font-size:13px;color:#475569;margin-top:8px}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-bottom:1px solid #e5e7eb;padding:10px;text-align:left;font-size:15px}
  th{background:#f3f6ff;color:#0b2574}
  td input{width:100%;padding:8px;border:1px solid #e2e8f0;border-radius:8px;font-size:15px}
  .right{text-align:right}
  .hide{display:none}
  footer{max-width:1100px;margin:10px auto 26px;padding:0 18px;text-align:center;color:#64748b;font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>MVP - Simulador Indicadores de Metas Mobilizadoras</h1>
    <div class="row" style="margin-top:12px;justify-content:center">
      <div>
        <label>Escolha o indicador</label>
        <select id="indicador">
          <option value="produtividade">Produtividade</option>
          <option value="faturamento">Faturamento</option>
          <option value="cobertura">Cobertura de Atendimento a Estudantes</option>
          <option value="cobertura_me">Cobertura de Atendimento (ME e EPP)</option>
          <option value="municipios">Municípios Efetivos</option>
          <option value="recorrencia">Recorrência do Atendimento</option>
          <option value="fampeados">Fampeados Atendidos</option>
          <option value="subrep">Cobertura de Sub-representados</option>
          <option value="nps">NPS</option>
        </select>
      </div>
    </div>
  </div>

  <!-- PRODUTIVIDADE -->
  <section id="secProd" class="card">
    <h2>Produtividade</h2>
    <div class="row" style="margin:8px 0 4px;justify-content:space-between">
      <div class="row" style="gap:24px">
        <div><label>Resultado 1º ciclo (%)</label><div class="suf"><input id="p_r1" type="number" step="0.01" value="17.72" readonly></div></div>
        <div><label>Resultado 2º ciclo (%)</label><div class="suf"><input id="p_r2" type="number" step="0.01" value="35.82" readonly></div></div>
        <div><label>Resultado 3º ciclo (%)</label><div class="suf"><input id="p_r3" type="number" step="0.01" placeholder="ex.: 28,50"></div></div>
      </div>
      <div class="row" style="gap:24px">
        <div><label>Empresas 1º ciclo</label><input id="p_n1" type="number" step="1" value="272" readonly></div>
        <div><label>Empresas 2º ciclo</label><input id="p_n2" type="number" step="1" value="320" readonly></div>
        <div><label>Empresas 3º ciclo</label><input id="p_n3" type="number" step="1" placeholder="ex.: 250"></div>
      </div>
    </div>
    <div class="kpis">
      <div class="kpi"><div class="title">Consolidado atual (1º+2º)</div><div id="p_curr" class="value">0,00%</div></div>
      <div class="kpi"><div class="title">Consolidado final (com 3º ciclo)</div><div id="p_final" class="value">0,00%</div></div>
      <div class="kpi"><div class="title">Totais</div><div class="value" id="p_tot">—</div><div class="muted" id="p_tot2">N1: — | N2: — | N3: —</div></div>
    </div>
    <div class="note">Fórmula: (R1×N1 + R2×N2 + R3×N3) ÷ (N1 + N2 + N3). Percentuais: 18,00 = 18%.</div>
    <div style="height:8px"></div>
    <h3 style="margin:8px 0">Meta (CSN 95–115%)</h3>
    <div class="row" style="gap:24px">
      <div><label>Meta atual (%)</label><div class="suf"><input id="p_T" type="number" step="0.01" value="18.00" readonly></div></div>
      <div><label>Meta simulada (%) (opcional)</label><div class="suf"><input id="p_Tsim" type="text" inputmode="decimal" placeholder="ex.: 22,00"></div></div>
    </div>
    <div class="kpis">
      <div class="kpi"><div class="title">Faixa 95–115% (meta atual)</div><div id="p_fx" class="value">—</div></div>
      <div class="kpi"><div class="title">Execução vs. meta atual</div><div id="p_ex" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta atual)</div><div class="value"><span id="p_st" class="badge">—</span></div></div>
    </div>
    <div class="kpis" id="p_simRow" style="display:none">
      <div class="kpi"><div class="title">Faixa 95–115% (meta simulada)</div><div id="p_fx2" class="value">—</div></div>
      <div class="kpi"><div class="title">Execução vs. meta simulada</div><div id="p_ex2" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta simulada)</div><div class="value"><span id="p_st2" class="badge">—</span></div></div>
    </div>
  </section>

  <!-- FATURAMENTO -->
  <section id="secFat" class="card hide">
    <h2>Faturamento</h2>
    <div class="muted">Carregue os <b>projetos</b> (já com <b>Público Direto</b>) e preencha a <b>Média simples (%)</b>.</div>
    <div class="row" style="margin-top:10px;gap:8px">
      <button class="btn" id="loadPreset">Carregar projetos com faturamento</button>
      <button class="btn" id="addRow">Adicionar projeto</button>
      <button class="btn sec" id="clearRows">Limpar lista</button>
      <button class="btn sec" id="pasteHelper">Colar dados</button>
      <span class="muted">“Colar dados” aceita: média%; público direto (TAB, ; ou espaço).</span>
    </div>
    <table id="fatTable">
      <thead>
        <tr>
          <th style="width:45%">Projeto/Processo</th>
          <th class="right" style="width:18%">Média simples (%)</th>
          <th class="right" style="width:18%">Público Direto</th>
          <th class="right" style="width:18%">Peso (auto)</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <th>Total</th>
          <th class="right" id="fatAvg">—</th>
          <th class="right" id="fatCli">0</th>
          <th class="right" id="fatPeso">—</th>
        </tr>
      </tfoot>
    </table>
    <div class="kpis">
      <div class="kpi"><div class="title">Média simples entre projetos</div><div id="f_media" class="value">0,00%</div></div>
      <div class="kpi"><div class="title">Média ponderada (resultado do indicador)</div><div id="f_pond" class="value">0,00%</div></div>
      <div class="kpi"><div class="title">Público Direto (soma)</div><div id="f_totalCli" class="value">0</div><div class="muted">Denominador da ponderação</div></div>
    </div>
    <div style="height:8px"></div>
    <h3 style="margin:8px 0">Meta (CSN 95–115%)</h3>
    <div class="row" style="gap:24px">
      <div><label>Meta atual (%)</label><div class="suf"><input id="f_T" type="number" step="0.01" value="12.00" readonly></div></div>
      <div><label>Meta simulada (%) (opcional)</label><div class="suf"><input id="f_Tsim" type="text" inputmode="decimal" placeholder="ex.: 15,00"></div></div>
    </div>
    <div class="kpis">
      <div class="kpi"><div class="title">Faixa 95–115% (meta atual)</div><div id="f_fx" class="value">—</div></div>
      <div class="kpi"><div class="title">Execução vs. meta atual</div><div id="f_ex" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta atual)</div><div class="value"><span id="f_st" class="badge">—</span></div></div>
    </div>
    <div class="kpis" id="f_simRow" style="display:none">
      <div class="kpi"><div class="title">Faixa 95–115% (meta simulada)</div><div id="f_fx2" class="value">—</div></div>
      <div class="kpi"><div class="title">Execução vs. meta simulada</div><div id="f_ex2" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta simulada)</div><div class="value"><span id="f_st2" class="badge">—</span></div></div>
    </div>
    <div class="note">Resultado = Σ(Média_i × PúblicoDireto_i) ÷ Σ(PúblicoDireto_i). Percentuais: 18,00 = 18%.</div>
  </section>

  <!-- COBERTURA ESTUDANTES -->
  <section id="secCob" class="card hide">
    <h2>Cobertura de Atendimento a Estudantes</h2>
    <div class="muted">Informe apenas <b>Atendimentos</b>. Universo fixo: <b>2.640.918</b>.</div>
    <div class="row" style="gap:24px;margin-top:8px">
      <div><label>Atendimentos (nº)</label><input id="c_at" type="number" step="1" placeholder="ex.: 52000"></div>
      <div><label>Universo de estudantes (nº)</label><input id="c_uni" type="number" step="1" value="2640918" readonly></div>
    </div>
    <div class="kpis">
      <div class="kpi"><div class="title">Cobertura (Atendimentos ÷ Universo)</div><div id="c_cob" class="value">0,00%</div></div>
      <div class="kpi"><div class="title">Atendimentos informados</div><div id="c_at_kpi" class="value">0</div></div>
      <div class="kpi"><div class="title">Universo</div><div id="c_uni_kpi" class="value">2.640.918</div></div>
    </div>
    <div style="height:8px"></div>
    <h3 style="margin:8px 0">Meta (CSN 95–115%)</h3>
    <div class="row" style="gap:24px">
      <div>
        <label>Meta atual (%)</label>
        <div class="suf"><input id="c_T" type="number" step="0.01" value="19.50" readonly></div>
        <div class="sub" id="c_T_abs">Equivalente a: — atendimentos</div>
      </div>
      <div>
        <label>Meta simulada (%) (opcional)</label>
        <div class="suf"><input id="c_Tsim" type="text" inputmode="decimal" placeholder="ex.: 22,00"></div>
      </div>
    </div>
    <div class="kpis">
      <div class="kpi">
        <div class="title">Faixa 95–115% (meta atual)</div>
        <div id="c_fx" class="value">—</div>
        <div id="c_fx_abs" class="sub">Atendimentos: —</div>
      </div>
      <div class="kpi"><div class="title">Execução vs. meta atual</div><div id="c_ex" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta atual)</div><div class="value"><span id="c_st" class="badge">—</span></div></div>
    </div>
    <div class="kpis" id="c_simRow" style="display:none">
      <div class="kpi">
        <div class="title">Faixa 95–115% (meta simulada)</div>
        <div id="c_fx2" class="value">—</div>
        <div id="c_fx2_abs" class="sub">Atendimentos: —</div>
      </div>
      <div class="kpi"><div class="title">Execução vs. meta simulada</div><div id="c_ex2" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta simulada)</div><div class="value"><span id="c_st2" class="badge">—</span></div></div>
    </div>
    <div class="note">Cobertura = Atendimentos ÷ Universo. Percentuais: 19,50 = 19,5%.</div>
  </section>

  <!-- COBERTURA ME e EPP -->
  <section id="secCobME" class="card hide">
    <h2>Cobertura de Atendimento (ME e EPP)</h2>
    <div class="muted">Informe apenas <b>Atendimentos</b> (empresas únicas). Universo fixo: <b>749.467</b>.</div>
    <div class="row" style="gap:24px;margin-top:8px">
      <div><label>Atendimentos (nº)</label><input id="cme_at" type="number" step="1" placeholder="ex.: 120000"></div>
      <div><label>Universo ME e EPP (nº)</label><input id="cme_uni" type="number" step="1" value="749467" readonly></div>
    </div>
    <div class="kpis">
      <div class="kpi"><div class="title">Cobertura (Atendimentos ÷ Universo)</div><div id="cme_cob" class="value">0,00%</div></div>
      <div class="kpi"><div class="title">Atendimentos informados</div><div id="cme_at_kpi" class="value">0</div></div>
      <div class="kpi"><div class="title">Universo</div><div id="cme_uni_kpi" class="value">749.467</div></div>
    </div>
    <div style="height:8px"></div>
    <h3 style="margin:8px 0">Meta (CSN 95–115%)</h3>
    <div class="row" style="gap:24px">
      <div>
        <label>Meta atual (%)</label>
        <div class="suf"><input id="cme_T" type="number" step="0.01" value="39.76" readonly></div>
        <div class="sub" id="cme_T_abs">Equivalente a: — atendimentos</div>
      </div>
      <div>
        <label>Meta simulada (%) (opcional)</label>
        <div class="suf"><input id="cme_Tsim" type="text" inputmode="decimal" placeholder="ex.: 42,00"></div>
      </div>
    </div>
    <div class="kpis">
      <div class="kpi">
        <div class="title">Faixa 95–115% (meta atual)</div>
        <div id="cme_fx" class="value">—</div>
        <div id="cme_fx_abs" class="sub">Atendimentos: —</div>
      </div>
      <div class="kpi"><div class="title">Execução vs. meta atual</div><div id="cme_ex" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta atual)</div><div class="value"><span id="cme_st" class="badge">—</span></div></div>
    </div>
    <div class="kpis" id="cme_simRow" style="display:none">
      <div class="kpi">
        <div class="title">Faixa 95–115% (meta simulada)</div>
        <div id="cme_fx2" class="value">—</div>
        <div id="cme_fx2_abs" class="sub">Atendimentos: —</div>
      </div>
      <div class="kpi"><div class="title">Execução vs. meta simulada</div><div id="cme_ex2" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta simulada)</div><div class="value"><span id="cme_st2" class="badge">—</span></div></div>
    </div>
    <div class="note">Cobertura = Atendimentos ÷ Universo (ME e EPP). Percentuais: 39,76 = 39,76%.</div>
  </section>

  <!-- MUNICÍPIOS EFETIVOS -->
  <section id="secMun" class="card hide">
    <h2>Municípios Efetivos</h2>
    <div class="muted">Informe apenas o total de <b>Municípios atendidos</b>. Universo fixo: <b>399</b>.</div>
    <div class="row" style="gap:24px;margin-top:8px">
      <div><label>Municípios atendidos (nº)</label><input id="m_at" type="number" step="1" placeholder="ex.: 240"></div>
      <div><label>Universo de municípios (nº)</label><input id="m_uni" type="number" step="1" value="399" readonly></div>
    </div>
    <div class="kpis">
      <div class="kpi"><div class="title">Cobertura (Municípios ÷ Universo)</div><div id="m_cob" class="value">0,00%</div></div>
      <div class="kpi"><div class="title">Municípios informados</div><div id="m_at_kpi" class="value">0</div></div>
      <div class="kpi"><div class="title">Universo</div><div id="m_uni_kpi" class="value">399</div></div>
    </div>
    <div style="height:8px"></div>
    <h3 style="margin:8px 0">Meta (CSN 95–115%)</h3>
    <div class="row" style="gap:24px">
      <div>
        <label>Meta atual (%)</label>
        <div class="suf"><input id="m_T" type="number" step="0.01" value="58.00" readonly></div>
        <div class="sub" id="m_T_abs">Equivalente a: — municípios</div>
      </div>
      <div>
        <label>Meta simulada (%) (opcional)</label>
        <div class="suf"><input id="m_Tsim" type="text" inputmode="decimal" placeholder="ex.: 60,00"></div>
      </div>
    </div>
    <div class="kpis">
      <div class="kpi">
        <div class="title">Faixa 95–115% (meta atual)</div>
        <div id="m_fx" class="value">—</div>
        <div id="m_fx_abs" class="sub">Municípios: —</div>
      </div>
      <div class="kpi"><div class="title">Execução vs. meta atual</div><div id="m_ex" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta atual)</div><div class="value"><span id="m_st" class="badge">—</span></div></div>
    </div>
    <div class="kpis" id="m_simRow" style="display:none">
      <div class="kpi">
        <div class="title">Faixa 95–115% (meta simulada)</div>
        <div id="m_fx2" class="value">—</div>
        <div id="m_fx2_abs" class="sub">Municípios: —</div>
      </div>
      <div class="kpi"><div class="title">Execução vs. meta simulada</div><div id="m_ex2" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta simulada)</div><div class="value"><span id="m_st2" class="badge">—</span></div></div>
    </div>
    <div class="note">Cobertura = Municípios atendidos ÷ 399. Percentuais: 58,00 = 58%.</div>
  </section>

  <!-- RECORRÊNCIA DO ATENDIMENTO -->
  <section id="secRec" class="card hide">
    <h2>Recorrência do Atendimento</h2>
    <div class="muted">Informe o total de <b>Pequenos atendidos</b> e quantos tiveram <b>+ de 1 atendimento</b>. Fórmula: (Recorrentes ÷ Atendidos).</div>
    <div class="row" style="gap:24px;margin-top:8px">
      <div><label>Pequenos atendidos (nº)</label><input id="r_den" type="number" step="1" placeholder="ex.: 645000"></div>
      <div><label>Atendidos com + de 1 (nº)</label><input id="r_num" type="number" step="1" placeholder="ex.: 367650"></div>
    </div>
    <div class="kpis">
      <div class="kpi"><div class="title">Recorrência (Recorrentes ÷ Atendidos)</div><div id="r_taxa" class="value">0,00%</div></div>
      <div class="kpi"><div class="title">Recorrentes informados</div><div id="r_num_kpi" class="value">0</div></div>
      <div class="kpi"><div class="title">Pequenos atendidos</div><div id="r_den_kpi" class="value">0</div></div>
    </div>
    <div style="height:8px"></div>
    <h3 style="margin:8px 0">Meta (CSN 95–115%)</h3>
    <div class="row" style="gap:24px">
      <div>
        <label>Meta atual (%)</label>
        <div class="suf"><input id="r_T" type="number" step="0.01" value="57.00" readonly></div>
        <div class="sub" id="r_T_abs">Equivalente a: — recorrentes</div>
      </div>
      <div>
        <label>Meta simulada (%) (opcional)</label>
        <div class="suf"><input id="r_Tsim" type="text" inputmode="decimal" placeholder="ex.: 60,00"></div>
      </div>
    </div>
    <div class="kpis">
      <div class="kpi">
        <div class="title">Faixa 95–115% (meta atual)</div>
        <div id="r_fx" class="value">—</div>
        <div id="r_fx_abs" class="sub">Recorrentes: —</div>
      </div>
      <div class="kpi"><div class="title">Execução vs. meta atual</div><div id="r_ex" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta atual)</div><div class="value"><span id="r_st" class="badge">—</span></div></div>
    </div>
    <div class="kpis" id="r_simRow" style="display:none">
      <div class="kpi">
        <div class="title">Faixa 95–115% (meta simulada)</div>
        <div id="r_fx2" class="value">—</div>
        <div id="r_fx2_abs" class="sub">Recorrentes: —</div>
      </div>
      <div class="kpi"><div class="title">Execução vs. meta simulada</div><div id="r_ex2" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta simulada)</div><div class="value"><span id="r_st2" class="badge">—</span></div></div>
    </div>
    <div class="note">Ex.: meta 57% com 645.000 atendidos ⇒ alvo ≈ 367.650 recorrentes.</div>
  </section>

  <!-- FAMPEADOS ATENDIDOS -->
  <section id="secFampe" class="card hide">
    <h2>Fampeados Atendidos</h2>
    <div class="muted">Informe <b>Fampeados atendidos pós-crédito</b> e o total de <b>Fampeados</b>. Fórmula: (Atendidos pós-crédito ÷ Total de fampeados).</div>
    <div class="row" style="gap:24px;margin-top:8px">
      <div><label>Fampeados atendidos pós-crédito (nº)</label><input id="fa_num" type="number" step="1" placeholder="ex.: 12.000"></div>
      <div><label>Fampeados total (nº)</label><input id="fa_den" type="number" step="1" placeholder="ex.: 40.000"></div>
    </div>
    <div class="kpis">
      <div class="kpi"><div class="title">Cobertura (Atendidos ÷ Total)</div><div id="fa_cob" class="value">0,00%</div></div>
      <div class="kpi"><div class="title">Atendidos pós-crédito</div><div id="fa_num_kpi" class="value">0</div></div>
      <div class="kpi"><div class="title">Fampeados total</div><div id="fa_den_kpi" class="value">0</div></div>
    </div>
    <div style="height:8px"></div>
    <h3 style="margin:8px 0">Meta (CSN 95–115%)</h3>
    <div class="row" style="gap:24px">
      <div>
        <label>Meta atual (%)</label>
        <div class="suf"><input id="fa_T" type="number" step="0.01" value="30.00" readonly></div>
        <div class="sub" id="fa_T_abs">Equivalente a: — atendidos</div>
      </div>
      <div>
        <label>Meta simulada (%) (opcional)</label>
        <div class="suf"><input id="fa_Tsim" type="text" inputmode="decimal" placeholder="ex.: 32,00"></div>
      </div>
    </div>
    <div class="kpis">
      <div class="kpi">
        <div class="title">Faixa 95–115% (meta atual)</div>
        <div id="fa_fx" class="value">—</div>
        <div id="fa_fx_abs" class="sub">Atendidos: —</div>
      </div>
      <div class="kpi"><div class="title">Execução vs. meta atual</div><div id="fa_ex" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta atual)</div><div class="value"><span id="fa_st" class="badge">—</span></div></div>
    </div>
    <div class="kpis" id="fa_simRow" style="display:none">
      <div class="kpi">
        <div class="title">Faixa 95–115% (meta simulada)</div>
        <div id="fa_fx2" class="value">—</div>
        <div id="fa_fx2_abs" class="sub">Atendidos: —</div>
      </div>
      <div class="kpi"><div class="title">Execução vs. meta simulada</div><div id="fa_ex2" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta simulada)</div><div class="value"><span id="fa_st2" class="badge">—</span></div></div>
    </div>
    <div class="note">Cobertura = Fampeados atendidos pós-crédito ÷ Fampeados total. Percentuais: 30,00 = 30%.</div>
  </section>

  <!-- SUB-REPRESENTADOS -->
  <section id="secSubrep" class="card hide">
    <h2>Cobertura de Sub-representados</h2>
    <div class="muted">
      Para cada grupo: <b>Cobertura</b> = (% do grupo entre os atendidos) ÷ (% do grupo na população – PNAD/PR).<br>
      Indicador final = <b>média simples</b> das coberturas dos grupos informados.
    </div>

    <div class="row" style="gap:24px;margin-top:10px">
      <div><label>Total de clientes únicos atendidos (nº)</label><input id="sr_total" type="number" step="1" placeholder="ex.: 624202"></div>
    </div>

    <div class="row" style="margin-top:10px;gap:8px">
      <button class="btn" id="sr_add">Adicionar grupo</button>
      <button class="btn sec" id="sr_clear">Limpar grupos</button>
      <span class="muted">Preencha: <b>Clientes do grupo</b> e <b>% na população (PNAD)</b>.</span>
    </div>

    <table id="srTable">
      <thead>
        <tr>
          <th style="width:28%">Grupo</th>
          <th class="right" style="width:18%">Clientes do grupo (nº)</th>
          <th class="right" style="width:18%">% na população (PNAD)</th>
          <th class="right" style="width:18%">% entre atendidos (auto)</th>
          <th class="right" style="width:18%">Cobertura do grupo (auto)</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <th>Totais</th>
          <th class="right" id="srCli">0</th>
          <th></th>
          <th class="right" id="srShare">—</th>
          <th class="right" id="srAvg">—</th>
        </tr>
      </tfoot>
    </table>

    <div class="kpis">
      <div class="kpi"><div class="title">Média simples das coberturas</div><div id="sr_media" class="value">0,00%</div></div>
      <div class="kpi"><div class="title">Grupos considerados</div><div id="sr_ng" class="value">0</div></div>
      <div class="kpi"><div class="title">Total atendidos</div><div id="sr_total_kpi" class="value">0</div></div>
    </div>

    <div style="height:8px"></div>
    <h3 style="margin:8px 0">Meta (CSN 95–115%)</h3>
    <div class="row" style="gap:24px">
      <div><label>Meta atual (%)</label><div class="suf"><input id="sr_T" type="number" step="0.01" value="71.00" readonly></div></div>
      <div><label>Meta simulada (%) (opcional)</label><div class="suf"><input id="sr_Tsim" type="text" inputmode="decimal" placeholder="ex.: 75,00"></div></div>
    </div>

    <div class="kpis">
      <div class="kpi"><div class="title">Faixa 95–115% (meta atual)</div><div id="sr_fx" class="value">—</div></div>
      <div class="kpi"><div class="title">Execução vs. meta atual</div><div id="sr_ex" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta atual)</div><div class="value"><span id="sr_st" class="badge">—</span></div></div>
    </div>

    <div class="kpis" id="sr_simRow" style="display:none">
      <div class="kpi"><div class="title">Faixa 95–115% (meta simulada)</div><div id="sr_fx2" class="value">—</div></div>
      <div class="kpi"><div class="title">Execução vs. meta simulada</div><div id="sr_ex2" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta simulada)</div><div class="value"><span id="sr_st2" class="badge">—</span></div></div>
    </div>

    <div class="note">
      Ex.: 296.578 mulheres (47,51% dos atendidos), PNAD 51% → cobertura = 47,51% ÷ 51% = 93,15%. Indicador = média simples das coberturas dos grupos.
    </div>
  </section>

  <!-- NPS -->
  <section id="secNps" class="card hide">
    <h2>NPS</h2>
    <div class="muted">Informe o <b>NPS alcançado</b> (em pontos). Meta também em <b>pontos</b> (não é %).</div>
    <div class="row" style="gap:24px;margin-top:8px">
      <div><label>NPS alcançado (pontos)</label><input id="n_nps" type="number" step="0.1" placeholder="ex.: 82,5"></div>
    </div>
    <div class="kpis">
      <div class="kpi"><div class="title">NPS informado</div><div id="n_val" class="value">0,00</div></div>
    </div>
    <div style="height:8px"></div>
    <h3 style="margin:8px 0">Meta (CSN 95–115%)</h3>
    <div class="row" style="gap:24px">
      <div>
        <label>Meta atual (pontos)</label>
        <input id="n_T" type="number" step="0.1" value="80.00" readonly>
        <div class="sub" id="n_T_abs">Meta em pontos: 80,00</div>
      </div>
      <div>
        <label>Meta simulada (pontos) (opcional)</label>
        <input id="n_Tsim" type="text" inputmode="decimal" placeholder="ex.: 85,0">
      </div>
    </div>
    <div class="kpis">
      <div class="kpi"><div class="title">Faixa 95–115% (meta atual)</div><div id="n_fx" class="value">—</div></div>
      <div class="kpi"><div class="title">Execução vs. meta atual</div><div id="n_ex_cur" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta atual)</div><div class="value"><span id="n_st_cur" class="badge">—</span></div></div>
    </div>
    <div class="kpis" id="n_simRow" style="display:none">
      <div class="kpi"><div class="title">Faixa 95–115% (meta simulada)</div><div id="n_fx2" class="value">—</div></div>
      <div class="kpi"><div class="title">Execução vs. meta simulada</div><div id="n_ex2" class="value">—</div></div>
      <div class="kpi"><div class="title">Status (meta simulada)</div><div class="value"><span id="n_st2" class="badge">—</span></div></div>
    </div>
    <div class="note">Execução = NPS alcançado ÷ NPS meta. Ex.: 84,0 ÷ 80,0 = 105,0%.</div>
  </section>
</div>

<footer>
  MVP criado por <b>Julio Volpatto</b> — Unidade de Gestão Estratégica (UGE) • Sebrae/PR
</footer>

<!-- Modal (Faturamento) -->
<div id="pasteModal" class="card" style="display:none;position:fixed;max-width:640px;left:50%;top:12%;transform:translateX(-50%);z-index:999">
  <h3 style="margin:0 0 6px">Colar dados (duas colunas: média%; público direto)</h3>
  <div class="muted">Ex.: <code>0,250[TAB]10</code> ou <code>25,0; 10</code>.</div>
  <textarea id="pasteArea" style="width:100%;height:180px;margin-top:8px;border:1px solid #cbd5e1;border-radius:12px;padding:10px;font-family:'Figtree',ui-monospace,Consolas,monospace"></textarea>
  <div class="row" style="margin-top:10px">
    <button class="btn" id="pasteApply">Aplicar</button>
    <button class="btn sec" id="pasteCancel">Cancelar</button>
  </div>
</div>

<script>
/* ===== Utils ===== */
const $ = id => document.getElementById(id);
const pctOut  = (x,dec=2)=>((x||0)*100).toFixed(dec).replace('.',',')+'%';
const ratioOut= (x,dec=1)=>((x||0)*100).toFixed(dec).replace('.',',')+'%';
const numOut  = (x,dec=2)=> (x||0).toFixed(dec).replace('.',',');
const toDec   = v => { if(v==null||v==='') return 0; const n=parseFloat((''+v).replace(',','.')); return isFinite(n)? n/100:0; };
const toNum   = v => { const n=parseFloat((''+v).replace(',','.')); return isFinite(n)? n:0; };
const fmtInt  = n => (Math.round(n||0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,'.');
function applyStatus(el,exec){
  let cls='ok',txt='Dentro da faixa';
  if(exec>1.15){cls='bad';txt='Acima de 115%';}
  else if(exec<0.95){cls='warn';txt='Abaixo de 95%';}
  el.className='badge '+cls; el.textContent=txt;
}

/* ===== Navegação ===== */
$('indicador').addEventListener('change', e=>{
  const val=e.target.value;
  ['secProd','secFat','secCob','secCobME','secMun','secRec','secFampe','secSubrep','secNps']
    .forEach(id=>$(id)&&$(id).classList.add('hide'));
  const map={produtividade:'secProd',faturamento:'secFat',cobertura:'secCob',cobertura_me:'secCobME',
             municipios:'secMun',recorrencia:'secRec',fampeados:'secFampe',subrep:'secSubrep',nps:'secNps'};
  $(map[val]).classList.remove('hide');
});

/* ===== Produtividade ===== */
function prodCompute(){
  const r1=toDec($('p_r1').value), r2=toDec($('p_r2').value), r3=toDec($('p_r3').value);
  const n1=toNum($('p_n1').value), n2=toNum($('p_n2').value), n3=toNum($('p_n3').value);
  const curr=(r1*n1+r2*n2)/Math.max(n1+n2,1);
  const final=(r1*n1+r2*n2+r3*n3)/Math.max(n1+n2+n3,1);
  $('p_curr').textContent=pctOut(curr);
  $('p_final').textContent=pctOut(final);
  $('p_tot').textContent=(n1+n2+n3)+' empresas';
  $('p_tot2').textContent=`N1: ${n1} | N2: ${n2} | N3: ${n3}`;
  const T=toDec($('p_T').value), rawTs=$('p_Tsim').value||'', Ts=toDec(rawTs);
  const low=0.95*T, high=1.15*T, ex=T>0?final/T:0;
  $('p_fx').textContent=`${pctOut(low)} — ${pctOut(high)}`;
  $('p_ex').textContent=ratioOut(ex);
  applyStatus($('p_st'),ex);
  const showSim = rawTs.trim()!=='' && Ts>0;
  $('p_simRow').style.display = showSim?'grid':'none';
  if(showSim){
    const low2=0.95*Ts, high2=1.15*Ts, ex2=Ts>0?final/Ts:0;
    $('p_fx2').textContent=`${pctOut(low2)} — ${pctOut(high2)}`;
    $('p_ex2').textContent=ratioOut(ex2);
    applyStatus($('p_st2'),ex2);
  }
}
['p_r3','p_n3','p_Tsim'].forEach(id=>$(id).addEventListener('input', prodCompute));
prodCompute();

/* ===== Faturamento ===== */
const fatTbody = $('fatTable').querySelector('tbody');
function addRow(data={proj:'',media:'',clientes:''}){
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td><input type="text" value="${data.proj||''}" placeholder="Projeto X"></td>
    <td class="right"><input type="number" step="0.01" value="${data.media||''}" placeholder="ex.: 25,00"></td>
    <td class="right"><input type="number" step="1" value="${data.clientes||''}" placeholder="ex.: 10"></td>
    <td class="right"><span class="muted">—</span></td>`;
  fatTbody.appendChild(tr);
  tr.querySelectorAll('input').forEach(el=>el.addEventListener('input', fatCompute));
}
function clearRows(){ fatTbody.innerHTML=''; fatCompute(); }
$('addRow').addEventListener('click',()=>addRow());
$('clearRows').addEventListener('click',clearRows);

/* LISTA PADRÃO DE PROJETOS (Público Direto) */
const FAT_PRESET = [
  {proj:'7173 - Comércio e Serviços - Regional Norte - Revitalização da Rua Ponta Grossa', clientes:17},
  {proj:'7305 - Startup - Regional Sul', clientes:36},
  {proj:'7310 - Startup - Regional Leste', clientes:30},
  {proj:'7312 - Startup - Regional Noroeste', clientes:55},
  {proj:'7367 - Agronegócio - Erva-Mate - Regional Sul', clientes:18},
  {proj:'7371 - Tic - Regional Norte', clientes:33},
  {proj:'7372 - Agronegócio - Hortifruticultura - Regional Centro', clientes:4},
  {proj:'7377 - Agronegócio - Fruticultura/Citricultura - Vale Do Ribeira', clientes:25},
  {proj:'7385 - Turismo Regional Oeste - DTI Foz Do Iguaçu', clientes:62},
  {proj:'7413 - Indústria - Eletrometalmecânico - Norte', clientes:56},
  {proj:'7421 - Indústria - Metalmecânico, Moveleiro, Moda e Alimentos - Sul', clientes:43},
  {proj:'7443 - Startup - Regional Oeste', clientes:41},
  {proj:'7445 - Setor Tic - Regional Curitiba', clientes:18},
  {proj:'7448 - Indústria – Alimentos e Bebidas – Norte Pioneiro', clientes:12},
  {proj:'7453 - Indústria - Centro - Campos Gerais - Alimentos, Móveis e Construção Civil', clientes:39},
  {proj:'7457 - TIC - Regional Noroeste', clientes:34},
  {proj:'7462 - Startup - Regional Curitiba', clientes:53},
  {proj:'7463 - Tic - Regional Oeste', clientes:40},
  {proj:'7467 - Setorial Turismo - Excelência Setorial - Curitiba', clientes:38},
  {proj:'7475 - Tic - Regional Sul', clientes:26},
  {proj:'7477 - Mercado Digital - Regional Noroeste', clientes:30},
  {proj:'7492 - Agronegócio - Apicultura E Meliponicultura - Regional Centro', clientes:20},
  {proj:'7493 - Turismo Na RMC - Regional Leste', clientes:50},
  {proj:'7497 - Comércio e Serviços - Varejo Inteligente - Regional Leste', clientes:40},
  {proj:'7501 - Agronegócio - Agroindústria - Regional Sul', clientes:5},
  {proj:'7502 - Agronegócio - Orgânicos - Vale Do Ribeira', clientes:10},
  {proj:'7507 - Agronegócio - Leite E Derivados - Território Paraná Centro', clientes:20},
  {proj:'7508 - Agronegócio - Agroindústria - Território Campos Gerais', clientes:10},
  {proj:'7510 - Agronegócio - Fruticultura - Norte Pioneiro', clientes:25},
  {proj:'7515 - Comércio E Serviços - Varejo Inteligente Regional Oeste', clientes:50},
  {proj:'7516 - Agronegócio - Orgânicos - Regional Leste', clientes:24},
  {proj:'7520 - Indicações Geográficas - Regional Centro', clientes:3},
  {proj:'7522 - Agronegócio - Agroindústria - Norte Pioneiro', clientes:10},
  {proj:'7524 - Agronegócio - Leite E Derivados - Regional Oeste', clientes:70},
  {proj:'7530 - Indústria - Construção Civil - Norte', clientes:22},
  {proj:'7532 - Agronegócio - Orgânicos - Território Procopense', clientes:15},
  {proj:'7533 - Indústria - Norte - Moda, Vestuário e Eletro Metal Mecânico - Vale do Ivaí', clientes:12},
  {proj:'7536 - Comércio E Serviços - Varejo Inteligente - Regional Noroeste', clientes:32},
  {proj:'7539 - Agronegócio - Piscicultura - Regional Oeste', clientes:20},
  {proj:'7551 - Indústria - Regional Centro - Vale Dos Pinheirais', clientes:2},
  {proj:'7556 - Indústria - Regional Centro - Vale Do Tibagi', clientes:3},
  {proj:'7560 - Agronegócio - Apicultura E Meliponicultura - Regional Leste', clientes:5},
  {proj:'7563 - Agronegócio - Apicultura e Meliponicultura - Norte Pioneiro', clientes:5},
  {proj:'7564 - Agronegócio - Apicultura E Meliponicultura - Regional Sul', clientes:52},
  {proj:'7565 - Agronegócio - Apicultura E Meliponicultura - Vale Do Ribeira', clientes:10},
  {proj:'7577 - Indicação Geográfica - Regional Oeste', clientes:2},
  {proj:'7579 - Indústria - Centro - Alimentos - Paraná Centro', clientes:5},
  {proj:'7581 - Tic - Regional Centro', clientes:15},
  {proj:'7585 - Indicação Geográfica - Regional Noroeste - Território Terra Roxa', clientes:2},
  {proj:'7586 - Indicação Geográfica- Norte Pioneiro', clientes:30},
  {proj:'7588 - Startup - Regional Centro', clientes:25},
  {proj:'7590 - Startup - Regional Norte', clientes:43},
  {proj:'7592 - Turismo DTI Guarapuava e Serras Nascentes Da Regional Centro', clientes:10},
  {proj:'7593 - Agronegócio - Agroindústria - Regional Leste', clientes:15},
  {proj:'7594 - Agronegócio - Leite E Derivados - Território Arenito Caiuá', clientes:20},
  {proj:'7598 - Comércio E Serviços - Varejo Inteligente - Regional Centro', clientes:25},
  {proj:'7601 - Turismo No Litoral Do Paraná - Regional Leste', clientes:20},
  {proj:'7612 - Turismo Mice e Vale Do Tibagi Da Regional Centro', clientes:10},
  {proj:'7620 - Indústria - Norte - Madeira e Móveis - Arapongas', clientes:12},
  {proj:'7624 - Agronegócio - Agroindústrias - Regional Oeste', clientes:20},
  {proj:'7627 - Comércio e Serviços - Varejo Inteligente - Regional Norte', clientes:30},
  {proj:'7629 - Agronegócio - Leite e Derivados - Norte Pioneiro', clientes:10},
  {proj:'7630 - Indicação Geográfica - Regional Sul', clientes:3},
  {proj:'7634 - Agronegócio - Proteína Animal: Carnes Nobres – Regional Noroeste', clientes:10},
  {proj:'7641 - Agronegócio - Leite E Derivados - Regional Sul', clientes:12},
  {proj:'7644 - Turismo - Regional Sul - Excelência Setorial', clientes:26},
  {proj:'7655 - Turismo Em Terra Roxa - Regional Noroeste', clientes:45},
  {proj:'7660 - Agronegócio - Orgânicos - Regional Oeste', clientes:50},
  {proj:'7661 - Turismo em Áreas Naturais e Patrimônio Cultural no Vale dos Pinheirais da Regional Centro', clientes:10},
  {proj:'7662 - Turismo Dti Ponta Grossa e Campos Gerais Da Regional Centro', clientes:26},
  {proj:'7663 - Turismo - Regional Norte - Vale Do Ivaí', clientes:13},
  {proj:'7665 - Turismo Regional Norte - Território Paranapanema', clientes:13},
  {proj:'7667 - Agronegócio - Vitivinicultura - Regional Sul', clientes:10},
  {proj:'7670 - Agronegócio - Café - Norte Pioneiro', clientes:30},
  {proj:'7671 - Agronegócio - Hortifruticultura - Regional Leste', clientes:15},
  {proj:'7672 - Indicação Geográfica - Regional Leste', clientes:5},
  {proj:'7675 - Indústria – Norte - Alimentos e bebidas – Norte do Paraná', clientes:12},
  {proj:'7676 - Comércio E Serviços - Varejo Inteligente - Regional Sul', clientes:31},
  {proj:'7678 - Indústria - Metalmecânica, Biotecnologia, Alimentos e Bebidas - Leste', clientes:114},
  {proj:'7686 - Agronegócio - Orgânicos - Norte Pioneiro', clientes:30},
  {proj:'7689 - Industria - Saúde - Norte', clientes:26},
  {proj:'7694 - Turismo Regional Norte - Norte Do Paraná', clientes:29},
  {proj:'7695 - Indústria - Oeste - Metalmecânica', clientes:91},
  {proj:'7699 - Turismo Regional Norte - Norte Pioneiro', clientes:14},
  {proj:'7709 - Turismo No Arenito Caiuá Na Regional Noroeste', clientes:24},
  {proj:'7711 - Indicação Geográfica - Território Norte Central', clientes:1},
  {proj:'7712 - Indicação Geográfica - Território Vale Do Ivaí', clientes:15},
  {proj:'7724 - Indústria - MMecânico, C Civil, Móveis e Vestuário - Noroeste', clientes:58},
  {proj:'7727 - Indústria – Químico e Materiais – Norte - Londrina e região', clientes:12},
  {proj:'7734 - Agronegócio - Agroindústria - Regional Noroeste', clientes:20},
  {proj:'7743 - Tic - Regional Leste', clientes:20},
  {proj:'7748 - Comércio E Serviços - Saúde E Bem Estar - Regional Noroeste', clientes:21},
  {proj:'7749 - Indústria – Alimentos, Construção Civil e Metal Mecânica - Curitiba', clientes:100},
  {proj:'7754 - Comércio e Serviços – Regional Curitiba – Varejo Inteligente', clientes:18},
  {proj:'7757 - Agronegócio - Agroindústria - Norte do Paraná', clientes:35},
  {proj:'7758 - Agronegócio - Fruticultura - Território Vale do Ivaí', clientes:25},
  {proj:'7763 - Agronegócio – Piscicultura - Castro', clientes:16},
  {proj:'7764 - Revitalização de Espaços Comerciais - Paranavaí', clientes:20},
  {proj:'7766 - TIC – Paraná Centro', clientes:10},
  {proj:'7767 - Comércio e Serviços – Paraná Centro', clientes:20},
  {proj:'7768 - Startup – Paraná Centro', clientes:20},
];

$('loadPreset').addEventListener('click', ()=>{
  clearRows();
  FAT_PRESET.forEach(p => addRow({ proj: p.proj, media: '', clientes: p.clientes }));
  fatCompute();
});

function splitCols(line){ if(line.indexOf('\t')>=0) return line.split('\t'); if(line.indexOf(';')>=0) return line.split(';'); return line.trim().split(/\s{2,}|\s+/); }
function parsePercentToken(tok){ if(!tok) return NaN; let t=String(tok).trim().replace('%','').replace('\u00A0',' ').replace(',','.'); let v=parseFloat(t); if(!isFinite(v)) return NaN; if(v<=1) v=v*100; return v; }
function parseClientesToken(tok){ if(!tok) return NaN; let t=String(tok).trim().replace(/\./g,'').replace(/\s/g,'').replace(',','.'); let n=parseFloat(t); return isFinite(n)? Math.round(n):NaN; }

$('pasteHelper').addEventListener('click',()=>{ $('pasteModal').style.display='block'; $('pasteArea').value=''; });
$('pasteCancel').addEventListener('click',()=>{ $('pasteModal').style.display='none'; });
$('pasteApply').addEventListener('click',()=>{
  const lines=$('pasteArea').value.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  lines.forEach(l=>{
    const parts=splitCols(l).filter(Boolean);
    if(parts.length>=2){
      const media=parsePercentToken(parts[0]);
      const client=parseClientesToken(parts[1]);
      addRow({media:isFinite(media)?media.toFixed(2):'', clientes:isFinite(client)?String(client):''});
    }
  });
  $('pasteModal').style.display='none';
  fatCompute();
});

function fatCompute(){
  const rows=Array.from(fatTbody.querySelectorAll('tr'));
  let sumClientes=0,sumPesos=0,sumMedias=0,nProjetos=0;
  rows.forEach(tr=>{
    const mediaStr=tr.children[1].querySelector('input').value;
    const cliStr  =tr.children[2].querySelector('input').value;
    const mediaDec=toDec(mediaStr);
    const clientes=toNum(cliStr);
    if(clientes>0 || mediaDec>0){ nProjetos++; sumClientes+=clientes; sumPesos+=(mediaDec*clientes); sumMedias+=mediaDec; }
    const peso=(mediaDec*clientes);
    tr.children[3].innerHTML=`<b>${pctOut(peso)}</b>`;
  });
  const mediaSimples=nProjetos>0?sumMedias/nProjetos:0;
  const mediaPonderada=sumClientes>0?sumPesos/sumClientes:0;

  $('fatCli').textContent=sumClientes;
  $('fatPeso').textContent=pctOut(sumPesos);
  $('fatAvg').textContent=pctOut(mediaSimples);
  $('f_media').textContent=pctOut(mediaSimples);
  $('f_pond').textContent=pctOut(mediaPonderada);
  $('f_totalCli').textContent=sumClientes;

  const T=toDec($('f_T').value), rawTs=$('f_Tsim').value||'', Ts=toDec(rawTs);
  const low=0.95*T, high=1.15*T, ex=T>0?mediaPonderada/T:0;
  $('f_fx').textContent=`${pctOut(low)} — ${pctOut(high)}`;
  $('f_ex').textContent=ratioOut(ex);
  applyStatus($('f_st'),ex);
  const showSim = rawTs.trim()!=='' && Ts>0;
  $('f_simRow').style.display = showSim?'grid':'none';
  if(showSim){
    const low2=0.95*Ts, high2=1.15*Ts, ex2=Ts>0?mediaPonderada/Ts:0;
    $('f_fx2').textContent=`${pctOut(low2)} — ${pctOut(high2)}`;
    $('f_ex2').textContent=ratioOut(ex2);
    applyStatus($('f_st2'),ex2);
  }
}

/* ===== Cobertura – Estudantes ===== */
function cobCompute(){
  const at = toNum($('c_at').value);
  const uni = toNum($('c_uni').value) || 2640918;
  const cob = uni>0 ? at/uni : 0;
  $('c_cob').textContent = pctOut(cob);
  $('c_at_kpi').textContent = fmtInt(at);
  $('c_uni_kpi').textContent = fmtInt(uni);
  const T = toDec($('c_T').value);
  const low=0.95*T, high=1.15*T, ex=T>0?cob/T:0;
  $('c_fx').textContent=`${pctOut(low)} — ${pctOut(high)}`;
  $('c_fx_abs').textContent = `Atendimentos: ${fmtInt(Math.round(low*uni))} — ${fmtInt(Math.round(high*uni))}`;
  $('c_T_abs').textContent = `Equivalente a: ${fmtInt(Math.round(T*uni))} atendimentos`;
  $('c_ex').textContent=ratioOut(ex); applyStatus($('c_st'),ex);
  const rawTs = $('c_Tsim').value||''; const Ts = toDec(rawTs); const showSim = rawTs.trim()!=='' && Ts>0;
  $('c_simRow').style.display = showSim?'grid':'none';
  if(showSim){
    const low2=0.95*Ts, high2=1.15*Ts, ex2=Ts>0?cob/Ts:0;
    $('c_fx2').textContent=`${pctOut(low2)} — ${pctOut(high2)}`;
    $('c_fx2_abs').textContent = `Atendimentos: ${fmtInt(Math.round(low2*uni))} — ${fmtInt(Math.round(high2*uni))}`;
    $('c_ex2').textContent=ratioOut(ex2); applyStatus($('c_st2'),ex2);
  }
}
['c_at','c_Tsim'].forEach(id=>$(id).addEventListener('input', cobCompute));
cobCompute();

/* ===== Cobertura – ME e EPP ===== */
function cobMECompute(){
  const at = toNum($('cme_at').value);
  const uni = toNum($('cme_uni').value) || 749467;
  const cob = uni>0 ? at/uni : 0;
  $('cme_cob').textContent = pctOut(cob);
  $('cme_at_kpi').textContent = fmtInt(at);
  $('cme_uni_kpi').textContent = fmtInt(uni);
  const T = toDec($('cme_T').value);
  const low=0.95*T, high=1.15*T, ex=T>0?cob/T:0;
  $('cme_fx').textContent=`${pctOut(low)} — ${pctOut(high)}`;
  $('cme_fx_abs').textContent = `Atendimentos: ${fmtInt(Math.round(low*uni))} — ${fmtInt(Math.round(high*uni))}`;
  $('cme_T_abs').textContent = `Equivalente a: ${fmtInt(Math.round(T*uni))} atendimentos`;
  $('cme_ex').textContent=ratioOut(ex); applyStatus($('cme_st'),ex);
  const rawTs = $('cme_Tsim').value||''; const Ts = toDec(rawTs); const showSim = rawTs.trim()!=='' && Ts>0;
  $('cme_simRow').style.display = showSim?'grid':'none';
  if(showSim){
    const low2=0.95*Ts, high2=1.15*Ts, ex2=Ts>0?cob/Ts:0;
    $('cme_fx2').textContent=`${pctOut(low2)} — ${pctOut(high2)}`;
    $('cme_fx2_abs').textContent = `Atendimentos: ${fmtInt(Math.round(low2*uni))} — ${fmtInt(Math.round(high2*uni))}`;
    $('cme_ex2').textContent=ratioOut(ex2); applyStatus($('cme_st2'),ex2);
  }
}
['cme_at','cme_Tsim'].forEach(id=>$(id).addEventListener('input', cobMECompute));
cobMECompute();

/* ===== Municípios ===== */
function munCompute(){
  const at = toNum($('m_at').value);
  const uni = toNum($('m_uni').value) || 399;
  const cob = uni>0 ? at/uni : 0;
  $('m_cob').textContent = pctOut(cob);
  $('m_at_kpi').textContent = fmtInt(at);
  $('m_uni_kpi').textContent = fmtInt(uni);
  const T = toDec($('m_T').value);
  const low=0.95*T, high=1.15*T, ex=T>0?cob/T:0;
  $('m_fx').textContent=`${pctOut(low)} — ${pctOut(high)}`;
  $('m_fx_abs').textContent = `Municípios: ${fmtInt(Math.round(low*uni))} — ${fmtInt(Math.round(high*uni))}`;
  $('m_T_abs').textContent = `Equivalente a: ${fmtInt(Math.round(T*uni))} municípios`;
  $('m_ex').textContent=ratioOut(ex); applyStatus($('m_st'),ex);
  const rawTs = $('m_Tsim').value||''; const Ts = toDec(rawTs); const showSim = rawTs.trim()!=='' && Ts>0;
  $('m_simRow').style.display = showSim?'grid':'none';
  if(showSim){
    const low2=0.95*Ts, high2=1.15*Ts, ex2=Ts>0?cob/Ts:0;
    $('m_fx2').textContent=`${pctOut(low2)} — ${pctOut(high2)}`;
    $('m_fx2_abs').textContent = `Municípios: ${fmtInt(Math.round(low2*uni))} — ${fmtInt(Math.round(high2*uni))}`;
    $('m_ex2').textContent=ratioOut(ex2); applyStatus($('m_st2'),ex2);
  }
}
['m_at','m_Tsim'].forEach(id=>$(id).addEventListener('input', munCompute));
munCompute();

/* ===== Recorrência ===== */
function recCompute(){
  const den = toNum($('r_den').value);
  const num = toNum($('r_num').value);
  const taxa = den>0 ? num/den : 0;
  $('r_taxa').textContent = pctOut(taxa);
  $('r_num_kpi').textContent = fmtInt(num);
  $('r_den_kpi').textContent = fmtInt(den);
  const T = toDec($('r_T').value);
  const low=0.95*T, high=1.15*T, ex=T>0?taxa/T:0;
  $('r_fx').textContent = `${pctOut(low)} — ${pctOut(high)}`;
  $('r_fx_abs').textContent = `Recorrentes: ${fmtInt(Math.round(low*den))} — ${fmtInt(Math.round(high*den))}`;
  $('r_T_abs').textContent = `Equivalente a: ${fmtInt(Math.round(T*den))} recorrentes`;
  $('r_ex').textContent = ratioOut(ex); applyStatus($('r_st'), ex);
  const rawTs = $('r_Tsim').value||''; const Ts = toDec(rawTs); const showSim = rawTs.trim()!=='' && Ts>0;
  $('r_simRow').style.display = showSim ? 'grid' : 'none';
  if(showSim){
    const low2=0.95*Ts, high2=1.15*Ts, ex2=Ts>0?taxa/Ts:0;
    $('r_fx2').textContent=`${pctOut(low2)} — ${pctOut(high2)}`
    $('r_fx2_abs').textContent = `Recorrentes: ${fmtInt(Math.round(low2*den))} — ${fmtInt(Math.round(high2*den))}`;
    $('r_ex2').textContent=ratioOut(ex2); applyStatus($('r_st2'),ex2);
  }
}
['r_den','r_num','r_Tsim'].forEach(id=>$(id).addEventListener('input', recCompute));
recCompute();

/* ===== Fampeados ===== */
function famCompute(){
  const num = toNum($('fa_num').value);
  const den = toNum($('fa_den').value);
  const cob = den>0 ? num/den : 0;
  $('fa_cob').textContent = pctOut(cob);
  $('fa_num_kpi').textContent = fmtInt(num);
  $('fa_den_kpi').textContent = fmtInt(den);

  const T = toDec($('fa_T').value);
  const low = 0.95*T, high = 1.15*T, ex = T>0 ? cob/T : 0;
  $('fa_fx').textContent = `${pctOut(low)} — ${pctOut(high)}`;
  $('fa_fx_abs').textContent = `Atendidos: ${fmtInt(Math.round(low*den))} — ${fmtInt(Math.round(high*den))}`;
  $('fa_T_abs').textContent = `Equivalente a: ${fmtInt(Math.round(T*den))} atendidos`;
  $('fa_ex').textContent = ratioOut(ex);
  applyStatus($('fa_st'), ex);

  const rawTs = $('fa_Tsim').value||''; const Ts = toDec(rawTs);
  const showSim = rawTs.trim()!=='' && Ts>0;
  $('fa_simRow').style.display = showSim ? 'grid' : 'none';
  if(showSim){
    const low2=0.95*Ts, high2=1.15*Ts, ex2 = Ts>0 ? cob/Ts : 0;
    $('fa_fx2').textContent = `${pctOut(low2)} — ${pctOut(high2)}`;
    $('fa_fx2_abs').textContent = `Atendidos: ${fmtInt(Math.round(low2*den))} — ${fmtInt(Math.round(high2*den))}`;
    $('fa_ex2').textContent = ratioOut(ex2);
    applyStatus($('fa_st2'), ex2);
  }
}
['fa_num','fa_den','fa_Tsim'].forEach(id=>$(id).addEventListener('input', famCompute));
famCompute();

/* ===== Sub-representados ===== */
const srTbody = (function(){ const t=$('srTable'); const tb=document.createElement('tbody'); t.insertBefore(tb, t.tFoot); return tb; })();
function srAddRow(data={grupo:'',n:'',pnad:''}){
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td><input type="text" value="${data.grupo||''}" placeholder="Ex.: Mulheres"></td>
    <td class="right"><input type="number" step="1" value="${data.n||''}" placeholder="ex.: 296578"></td>
    <td class="right"><input type="number" step="0.01" value="${data.pnad||''}" placeholder="ex.: 51,00"></td>
    <td class="right"><span class="muted">—</span></td>
    <td class="right"><span class="muted">—</span></td>`;
  srTbody.appendChild(tr);
  tr.querySelectorAll('input').forEach(el=>el.addEventListener('input', srCompute));
}
function srClear(){ srTbody.innerHTML=''; srCompute(); }
$('sr_add').addEventListener('click', ()=>srAddRow());
$('sr_clear').addEventListener('click', srClear);

function srCompute(){
  const total = toNum($('sr_total').value);
  $('sr_total_kpi').textContent = fmtInt(total);

  const rows = Array.from(srTbody.querySelectorAll('tr'));
  let sumN=0, nGroups=0, sumCoverage=0, sumShare=0;

  rows.forEach(tr=>{
    const n = toNum(tr.children[1].querySelector('input').value);
    const pnadPct = toDec(tr.children[2].querySelector('input').value); // fração
    sumN += n;

    const share = (total>0) ? (n/total) : 0; // % entre atendidos
    tr.children[3].innerHTML = `<b>${pctOut(share)}</b>`;

    let cov = 0;
    if(pnadPct>0){ cov = share / pnadPct; }
    tr.children[4].innerHTML = `<b>${pctOut(cov)}</b>`;

    if(n>0 && pnadPct>0){
      nGroups++;
      sumCoverage += cov;
      sumShare += share;
    }
  });

  $('srCli').textContent = fmtInt(sumN);
  $('srShare').textContent = nGroups>0 ? pctOut(sumShare/nGroups) : '—';

  const media = nGroups>0 ? (sumCoverage / nGroups) : 0;
  $('sr_media').textContent = pctOut(media);
  $('sr_ng').textContent = nGroups;
  $('srAvg').textContent = nGroups>0 ? pctOut(media) : '—';

  const T  = toDec($('sr_T').value);
  const low=0.95*T, high=1.15*T, ex = T>0 ? (media/T) : 0;
  $('sr_fx').textContent = `${pctOut(low)} — ${pctOut(high)}`;
  $('sr_ex').textContent = ratioOut(ex);
  applyStatus($('sr_st'), ex);

  const rawTs = $('sr_Tsim').value||''; const Ts = toDec(rawTs);
  const showSim = rawTs.trim()!=='' && Ts>0;
  $('sr_simRow').style.display = showSim?'grid':'none';
  if(showSim){
    const low2=0.95*Ts, high2=1.15*Ts, ex2 = Ts>0 ? (media/Ts) : 0;
    $('sr_fx2').textContent = `${pctOut(low2)} — ${pctOut(high2)}`;
    $('sr_ex2').textContent = ratioOut(ex2);
    applyStatus($('sr_st2'), ex2);
  }
}
/* Pré-carregar os 2 grupos usados (Mulheres e 60+) */
srAddRow({grupo:'Mulheres', n:'', pnad:'51,00'});
srAddRow({grupo:'60+', n:'', pnad:'20,00'});

['sr_total','sr_Tsim'].forEach(id=>$(id).addEventListener('input', srCompute));
srCompute();

/* ===== NPS ===== */
function npsCompute(){
  const nps = toNum($('n_nps').value);
  $('n_val').textContent = numOut(nps,2);
  const T = toNum($('n_T').value) || 0;
  const low = 0.95*T, high = 1.15*T;
  $('n_fx').textContent = `${numOut(low,2)} — ${numOut(high,2)}`;
  $('n_T_abs').textContent = `Meta em pontos: ${numOut(T,2)}`;
  const execAtual = T>0 ? (nps/T) : 0;
  $('n_ex_cur').textContent = ratioOut(execAtual);
  applyStatus($('n_st_cur'), execAtual);
  const rawTs = $('n_Tsim').value||'';
  const Ts = toNum(rawTs);
  const showSim = rawTs.trim()!=='' && Ts>0;
  $('n_simRow').style.display = showSim ? 'grid' : 'none';
  if(showSim){
    const low2=0.95*Ts, high2=1.15*Ts, ex2=Ts>0 ? (nps/Ts) : 0;
    $('n_fx2').textContent = `${numOut(low2,2)} — ${numOut(high2,2)}`;
    $('n_ex2').textContent = ratioOut(ex2);
    applyStatus($('n_st2'), ex2);
  }
}
['n_nps','n_Tsim'].forEach(id=>$(id).addEventListener('input', npsCompute));
npsCompute();
</script>
</body>
</html>
